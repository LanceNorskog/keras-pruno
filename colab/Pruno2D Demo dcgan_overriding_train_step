{"cells":[{"cell_type":"markdown","metadata":{"id":"2pSGEJm0xPjH"},"source":["# DCGAN to generate face images\n","\n","**Author:** [fchollet](https://twitter.com/fchollet)\u003cbr\u003e\n","**Date created:** 2019/04/29\u003cbr\u003e\n","**Last modified:** 2021/01/01\u003cbr\u003e\n","**Description:** A simple DCGAN trained using `fit()` by overriding `train_step` on CelebA images."]},{"cell_type":"markdown","metadata":{"id":"jotLOS-HxPjO"},"source":["## Setup"]},{"cell_type":"code","execution_count":1,"metadata":{"executionInfo":{"elapsed":3739,"status":"ok","timestamp":1618458571697,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"UyrrDA8IxPjP"},"outputs":[],"source":["import tensorflow as tf\n","from tensorflow import keras\n","from tensorflow.keras import layers\n","import numpy as np\n","import matplotlib.pyplot as plt\n","import os\n","import gdown\n","from zipfile import ZipFile"]},{"cell_type":"markdown","metadata":{"id":"FrRI0CsM03Uv"},"source":[""]},{"cell_type":"markdown","metadata":{"id":"FQKC0nmTxPjQ"},"source":["## Prepare CelebA data\n","\n","We'll use face images from the CelebA dataset, resized to 64x64."]},{"cell_type":"code","execution_count":2,"metadata":{"executionInfo":{"elapsed":53899,"status":"ok","timestamp":1618458621869,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"gL3Kv3BMxPjQ"},"outputs":[],"source":["if not os.path.exists(\"celeba_gan\"):\n","    os.makedirs(\"celeba_gan\")\n","\n","    url = \"https://drive.google.com/uc?id=1O7m1010EJjLE5QxLZiM9Fpjs7Oj6e684\"\n","    output = \"celeba_gan/data.zip\"\n","    gdown.download(url, output, quiet=True)\n","\n","    with ZipFile(\"celeba_gan/data.zip\", \"r\") as zipobj:\n","        zipobj.extractall(\"celeba_gan\")"]},{"cell_type":"markdown","metadata":{"id":"mClIwG6CxPjR"},"source":["Create a dataset from our folder, and rescale the images to the [0-1] range:"]},{"cell_type":"code","execution_count":31,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":6282,"status":"ok","timestamp":1618460468772,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"UPT7P6eWxPjR","outputId":"10730d26-d077-4a51-ad48-3f551c7ca78f"},"outputs":[{"name":"stdout","output_type":"stream","text":["Found 202599 files belonging to 1 classes.\n"]}],"source":["dataset = keras.preprocessing.image_dataset_from_directory(\n","    \"celeba_gan\", label_mode=None, image_size=(64, 64), batch_size=256\n",")\n","dataset = dataset.map(lambda x: x / 255.0)\n"]},{"cell_type":"markdown","metadata":{"id":"SGJDxZzaxPjR"},"source":["Let's display a sample image:"]},{"cell_type":"code","execution_count":32,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":248},"executionInfo":{"elapsed":8702,"status":"ok","timestamp":1618460471202,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"kzAYb48RxPjS","outputId":"0fc31492-3c23-45c5-8d3d-1e0dc6d5bae8"},"outputs":[{"data":{"image/png":"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\n","text/plain":["\u003cFigure size 432x288 with 1 Axes\u003e"]},"metadata":{"tags":[]},"output_type":"display_data"}],"source":["\n","for x in dataset:\n","    plt.axis(\"off\")\n","    plt.imshow((x.numpy() * 255).astype(\"int32\")[0])\n","    break\n"]},{"cell_type":"markdown","metadata":{"id":"i-6VkqqdxPjS"},"source":["## Create the discriminator\n","\n","It maps a 64x64 image to a binary classification score."]},{"cell_type":"code","execution_count":33,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8694,"status":"ok","timestamp":1618460471203,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"R_wGp3FixPjS","outputId":"de6391a0-a884-4ce2-a0d3-7a422ba0a4f3"},"outputs":[{"name":"stdout","output_type":"stream","text":["Model: \"discriminator\"\n","_________________________________________________________________\n","Layer (type)                 Output Shape              Param #   \n","=================================================================\n","conv2d_16 (Conv2D)           (None, 32, 32, 64)        3136      \n","_________________________________________________________________\n","leaky_re_lu_24 (LeakyReLU)   (None, 32, 32, 64)        0         \n","_________________________________________________________________\n","conv2d_17 (Conv2D)           (None, 16, 16, 128)       131200    \n","_________________________________________________________________\n","leaky_re_lu_25 (LeakyReLU)   (None, 16, 16, 128)       0         \n","_________________________________________________________________\n","conv2d_18 (Conv2D)           (None, 8, 8, 128)         262272    \n","_________________________________________________________________\n","leaky_re_lu_26 (LeakyReLU)   (None, 8, 8, 128)         0         \n","_________________________________________________________________\n","flatten_4 (Flatten)          (None, 8192)              0         \n","_________________________________________________________________\n","dropout_4 (Dropout)          (None, 8192)              0         \n","_________________________________________________________________\n","dense_8 (Dense)              (None, 1)                 8193      \n","=================================================================\n","Total params: 404,801\n","Trainable params: 404,801\n","Non-trainable params: 0\n","_________________________________________________________________\n"]}],"source":["discriminator = keras.Sequential(\n","    [\n","        keras.Input(shape=(64, 64, 3)),\n","        layers.Conv2D(64, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2D(128, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2D(128, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Flatten(),\n","        layers.Dropout(0.2),\n","        layers.Dense(1, activation=\"sigmoid\"),\n","    ],\n","    name=\"discriminator\",\n",")\n","discriminator.summary()"]},{"cell_type":"markdown","metadata":{"id":"j5vbcYvkxPjT"},"source":["## Create the generator\n","\n","It mirrors the discriminator, replacing `Conv2D` layers with `Conv2DTranspose` layers."]},{"cell_type":"code","execution_count":34,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8687,"status":"ok","timestamp":1618460471204,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"byAxNFQjxPjT","outputId":"5578fefe-14eb-4e8e-ee98-6b94bd1b4615"},"outputs":[{"name":"stdout","output_type":"stream","text":["Model: \"generator\"\n","_________________________________________________________________\n","Layer (type)                 Output Shape              Param #   \n","=================================================================\n","dense_9 (Dense)              (None, 8192)              1056768   \n","_________________________________________________________________\n","reshape_4 (Reshape)          (None, 8, 8, 128)         0         \n","_________________________________________________________________\n","conv2d_transpose_12 (Conv2DT (None, 16, 16, 128)       262272    \n","_________________________________________________________________\n","leaky_re_lu_27 (LeakyReLU)   (None, 16, 16, 128)       0         \n","_________________________________________________________________\n","conv2d_transpose_13 (Conv2DT (None, 32, 32, 256)       524544    \n","_________________________________________________________________\n","leaky_re_lu_28 (LeakyReLU)   (None, 32, 32, 256)       0         \n","_________________________________________________________________\n","conv2d_transpose_14 (Conv2DT (None, 64, 64, 512)       2097664   \n","_________________________________________________________________\n","leaky_re_lu_29 (LeakyReLU)   (None, 64, 64, 512)       0         \n","_________________________________________________________________\n","conv2d_19 (Conv2D)           (None, 64, 64, 3)         38403     \n","=================================================================\n","Total params: 3,979,651\n","Trainable params: 3,979,651\n","Non-trainable params: 0\n","_________________________________________________________________\n"]}],"source":["latent_dim = 128\n","\n","generator = keras.Sequential(\n","    [\n","        keras.Input(shape=(latent_dim,)),\n","        layers.Dense(8 * 8 * 128),\n","        layers.Reshape((8, 8, 128)),\n","        layers.Conv2DTranspose(128, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2DTranspose(256, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2DTranspose(512, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2D(3, kernel_size=5, padding=\"same\", activation=\"sigmoid\"),\n","    ],\n","    name=\"generator\",\n",")\n","generator.summary()"]},{"cell_type":"markdown","metadata":{"id":"HWLEU-vuxPjT"},"source":["## Override `train_step`"]},{"cell_type":"code","execution_count":35,"metadata":{"executionInfo":{"elapsed":8679,"status":"ok","timestamp":1618460471204,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"TwmOOPvHxPjU"},"outputs":[],"source":["\n","class GAN(keras.Model):\n","    def __init__(self, discriminator, generator, latent_dim):\n","        super(GAN, self).__init__()\n","        self.discriminator = discriminator\n","        self.generator = generator\n","        self.latent_dim = latent_dim\n","\n","    def compile(self, d_optimizer, g_optimizer, loss_fn):\n","        super(GAN, self).compile()\n","        self.d_optimizer = d_optimizer\n","        self.g_optimizer = g_optimizer\n","        self.loss_fn = loss_fn\n","        self.d_loss_metric = keras.metrics.Mean(name=\"d_loss\")\n","        self.g_loss_metric = keras.metrics.Mean(name=\"g_loss\")\n","\n","    @property\n","    def metrics(self):\n","        return [self.d_loss_metric, self.g_loss_metric]\n","\n","    def train_step(self, real_images):\n","        # Sample random points in the latent space\n","        batch_size = tf.shape(real_images)[0]\n","        random_latent_vectors = tf.random.normal(shape=(batch_size, self.latent_dim))\n","\n","        # Decode them to fake images\n","        generated_images = self.generator(random_latent_vectors)\n","\n","        # Combine them with real images\n","        combined_images = tf.concat([generated_images, real_images], axis=0)\n","\n","        # Assemble labels discriminating real from fake images\n","        labels = tf.concat(\n","            [tf.ones((batch_size, 1)), tf.zeros((batch_size, 1))], axis=0\n","        )\n","        # Add random noise to the labels - important trick!\n","        labels += 0.05 * tf.random.uniform(tf.shape(labels))\n","\n","        # Train the discriminator\n","        with tf.GradientTape() as tape:\n","            predictions = self.discriminator(combined_images)\n","            d_loss = self.loss_fn(labels, predictions)\n","        grads = tape.gradient(d_loss, self.discriminator.trainable_weights)\n","        self.d_optimizer.apply_gradients(\n","            zip(grads, self.discriminator.trainable_weights)\n","        )\n","\n","        # Sample random points in the latent space\n","        random_latent_vectors = tf.random.normal(shape=(batch_size, self.latent_dim))\n","\n","        # Assemble labels that say \"all real images\"\n","        misleading_labels = tf.zeros((batch_size, 1))\n","\n","        # Train the generator (note that we should *not* update the weights\n","        # of the discriminator)!\n","        with tf.GradientTape() as tape:\n","            predictions = self.discriminator(self.generator(random_latent_vectors))\n","            g_loss = self.loss_fn(misleading_labels, predictions)\n","        grads = tape.gradient(g_loss, self.generator.trainable_weights)\n","        self.g_optimizer.apply_gradients(zip(grads, self.generator.trainable_weights))\n","\n","        # Update metrics\n","        self.d_loss_metric.update_state(d_loss)\n","        self.g_loss_metric.update_state(g_loss)\n","        return {\n","            \"d_loss\": self.d_loss_metric.result(),\n","            \"g_loss\": self.g_loss_metric.result(),\n","        }\n"]},{"cell_type":"markdown","metadata":{"id":"eMw-S94UxPjU"},"source":["## Create a callback that periodically saves generated images"]},{"cell_type":"code","execution_count":36,"metadata":{"executionInfo":{"elapsed":8673,"status":"ok","timestamp":1618460471205,"user":{"displayName":"Lance N.","photoUrl":"","userId":"10641691903871358793"},"user_tz":420},"id":"KRqbpwmKxPjV"},"outputs":[],"source":["\n","class GANMonitor(keras.callbacks.Callback):\n","    def __init__(self, num_img=3, latent_dim=128):\n","        self.num_img = num_img\n","        self.latent_dim = latent_dim\n","\n","    def on_epoch_end(self, epoch, logs=None):\n","        random_latent_vectors = tf.random.normal(shape=(self.num_img, self.latent_dim))\n","        generated_images = self.model.generator(random_latent_vectors)\n","        generated_images *= 255\n","        generated_images.numpy()\n","        for i in range(self.num_img):\n","            img = keras.preprocessing.image.array_to_img(generated_images[i])\n","            img.save(\"generated_img_%03d_%d.png\" % (epoch, i))\n"]},{"cell_type":"markdown","metadata":{"id":"SUhkAXxbxPjV"},"source":["## Train the end-to-end model"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"id":"1CLNhr3RxPjW"},"outputs":[{"name":"stdout","output_type":"stream","text":["Epoch 1/25\n","792/792 - 480s - d_loss: 0.5663 - g_loss: 1.3431\n","Epoch 2/25\n","792/792 - 473s - d_loss: 0.6174 - g_loss: 1.3085\n","Epoch 3/25\n"]},{"ename":"KeyboardInterrupt","evalue":"ignored","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m\u003cipython-input-37-94f6885f75ee\u003e\u001b[0m in \u001b[0;36m\u003cmodule\u003e\u001b[0;34m()\u001b[0m\n\u001b[1;32m     10\u001b[0m gan.fit(\n\u001b[1;32m     11\u001b[0m     \u001b[0mdataset\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mepochs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mepochs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcallbacks\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mGANMonitor\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mnum_img\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m10\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mlatent_dim\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mlatent_dim\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---\u003e 12\u001b[0;31m     \u001b[0mverbose\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m2\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     13\u001b[0m )\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/keras/engine/training.py\u001b[0m in \u001b[0;36mfit\u001b[0;34m(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_batch_size, validation_freq, max_queue_size, workers, use_multiprocessing)\u001b[0m\n\u001b[1;32m   1098\u001b[0m                 _r=1):\n\u001b[1;32m   1099\u001b[0m               \u001b[0mcallbacks\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mon_train_batch_begin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mstep\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-\u003e 1100\u001b[0;31m               \u001b[0mtmp_logs\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtrain_function\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0miterator\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1101\u001b[0m               \u001b[0;32mif\u001b[0m \u001b[0mdata_handler\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshould_sync\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1102\u001b[0m                 \u001b[0mcontext\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0masync_wait\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/eager/def_function.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, *args, **kwds)\u001b[0m\n\u001b[1;32m    826\u001b[0m     \u001b[0mtracing_count\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexperimental_get_tracing_count\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    827\u001b[0m     \u001b[0;32mwith\u001b[0m \u001b[0mtrace\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mTrace\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_name\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0mtm\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--\u003e 828\u001b[0;31m       \u001b[0mresult\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_call\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwds\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    829\u001b[0m       \u001b[0mcompiler\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m\"xla\"\u001b[0m \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_experimental_compile\u001b[0m \u001b[0;32melse\u001b[0m \u001b[0;34m\"nonXla\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    830\u001b[0m       \u001b[0mnew_tracing_count\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexperimental_get_tracing_count\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/eager/def_function.py\u001b[0m in \u001b[0;36m_call\u001b[0;34m(self, *args, **kwds)\u001b[0m\n\u001b[1;32m    853\u001b[0m       \u001b[0;31m# In this case we have created variables on the first call, so we run the\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    854\u001b[0m       \u001b[0;31m# defunned version which is guaranteed to never create variables.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--\u003e 855\u001b[0;31m       \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_stateless_fn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwds\u001b[0m\u001b[0;34m)\u001b[0m  \u001b[0;31m# pylint: disable=not-callable\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    856\u001b[0m     \u001b[0;32melif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_stateful_fn\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    857\u001b[0m       \u001b[0;31m# Release the lock early so that multiple threads can perform the call\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/eager/function.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, *args, **kwargs)\u001b[0m\n\u001b[1;32m   2941\u001b[0m        filtered_flat_args) = self._maybe_define_function(args, kwargs)\n\u001b[1;32m   2942\u001b[0m     return graph_function._call_flat(\n\u001b[0;32m-\u003e 2943\u001b[0;31m         filtered_flat_args, captured_inputs=graph_function.captured_inputs)  # pylint: disable=protected-access\n\u001b[0m\u001b[1;32m   2944\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   2945\u001b[0m   \u001b[0;34m@\u001b[0m\u001b[0mproperty\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/eager/function.py\u001b[0m in \u001b[0;36m_call_flat\u001b[0;34m(self, args, captured_inputs, cancellation_manager)\u001b[0m\n\u001b[1;32m   1917\u001b[0m       \u001b[0;31m# No tape is watching; skip to running the function.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1918\u001b[0m       return self._build_call_outputs(self._inference_function.call(\n\u001b[0;32m-\u003e 1919\u001b[0;31m           ctx, args, cancellation_manager=cancellation_manager))\n\u001b[0m\u001b[1;32m   1920\u001b[0m     forward_backward = self._select_forward_and_backward_functions(\n\u001b[1;32m   1921\u001b[0m         \u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/eager/function.py\u001b[0m in \u001b[0;36mcall\u001b[0;34m(self, ctx, args, cancellation_manager)\u001b[0m\n\u001b[1;32m    558\u001b[0m               \u001b[0minputs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    559\u001b[0m               \u001b[0mattrs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mattrs\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--\u003e 560\u001b[0;31m               ctx=ctx)\n\u001b[0m\u001b[1;32m    561\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    562\u001b[0m           outputs = execute.execute_with_cancellation(\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/tensorflow/python/eager/execute.py\u001b[0m in \u001b[0;36mquick_execute\u001b[0;34m(op_name, num_outputs, inputs, attrs, ctx, name)\u001b[0m\n\u001b[1;32m     58\u001b[0m     \u001b[0mctx\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mensure_initialized\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     59\u001b[0m     tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,\n\u001b[0;32m---\u003e 60\u001b[0;31m                                         inputs, attrs, num_outputs)\n\u001b[0m\u001b[1;32m     61\u001b[0m   \u001b[0;32mexcept\u001b[0m \u001b[0mcore\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_NotOkStatusException\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     62\u001b[0m     \u001b[0;32mif\u001b[0m \u001b[0mname\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}],"source":["epochs = 25  # In practice, use ~100 epochs\n","\n","gan = GAN(discriminator=discriminator, generator=generator, latent_dim=latent_dim)\n","gan.compile(\n","    d_optimizer=keras.optimizers.Adam(learning_rate=0.0001),\n","    g_optimizer=keras.optimizers.Adam(learning_rate=0.0001),\n","    loss_fn=keras.losses.BinaryCrossentropy(),\n",")\n","\n","gan.fit(\n","    dataset, epochs=epochs, callbacks=[GANMonitor(num_img=10, latent_dim=latent_dim)],\n","    verbose=2\n",")"]},{"cell_type":"markdown","metadata":{"id":"pKzkqrJ4xPjW"},"source":["Some of the last generated images around epoch 30\n","(results keep improving after that):\n","\n","![results](https://i.imgur.com/h5MtQZ7l.png)"]},{"cell_type":"markdown","metadata":{"id":"DXoVXSGJx6Hs"},"source":["# Pruno2D"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"b9dCqMu4yIcr"},"outputs":[],"source":["!pip install -q git+https://github.com/LanceNorskog/keras-pruno.git\n","from keras_pruno import Pruno2D"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"idX7u0rZx6vL"},"outputs":[],"source":["discriminator_pruno = keras.Sequential(\n","    [\n","        keras.Input(shape=(64, 64, 3)),\n","        layers.Conv2D(64, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2D(128, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2D(128, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        Pruno2D(similarity=0.65),\n","        layers.Flatten(),\n","        layers.Dropout(0.2),\n","        layers.Dense(1, activation=\"sigmoid\"),\n","    ],\n","    name=\"discriminator\",\n",")\n","discriminator_pruno.summary()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Is8LHXCj3xtB"},"outputs":[],"source":["latent_dim = 128\n","\n","generator_pruno = keras.Sequential(\n","    [\n","        keras.Input(shape=(latent_dim,)),\n","        layers.Dense(8 * 8 * 128),\n","        layers.Reshape((8, 8, 128)),\n","        layers.Conv2DTranspose(128, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2DTranspose(256, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        layers.Conv2DTranspose(512, kernel_size=4, strides=2, padding=\"same\"),\n","        layers.LeakyReLU(alpha=0.2),\n","        Pruno2D(similarity=0.65),\n","        layers.Conv2D(3, kernel_size=5, padding=\"same\", activation=\"sigmoid\"),\n","    ],\n","    name=\"generator\",\n",")\n","generator_pruno.summary()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"la80oQjoyEqr"},"outputs":[],"source":["epochs = 25  # In practice, use ~100 epochs\n","\n","gan = GAN(discriminator=discriminator_pruno, generator=generator_pruno, latent_dim=latent_dim)\n","gan.compile(\n","    d_optimizer=keras.optimizers.Adam(learning_rate=0.0001),\n","    g_optimizer=keras.optimizers.Adam(learning_rate=0.0001),\n","    loss_fn=keras.losses.BinaryCrossentropy(),\n",")\n","\n","gan.fit(\n","    dataset, epochs=epochs, callbacks=[GANMonitor(num_img=10, latent_dim=latent_dim)]\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"zP7ovCUR3jRq"},"outputs":[],"source":[""]}],"metadata":{"accelerator":"GPU","colab":{"collapsed_sections":[],"machine_shape":"hm","name":"Pruno2D Demo dcgan_overriding_train_step","provenance":[{"file_id":"https://github.com/keras-team/keras-io/blob/master/examples/generative/ipynb/dcgan_overriding_train_step.ipynb","timestamp":1618376836150}],"toc_visible":true,"version":""},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.7.0"}},"nbformat":4,"nbformat_minor":0}